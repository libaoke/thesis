\chapter{基于双机暖备对的高可用互联网服务}
\label{cha:gemini}

\section{概述}
\label{sec:gemini_intro}
快速发展的云计算平台向其用户提供了大量充足的计算资源。每一天，在每一个普通的数据中心，通常有超过数千个服务器节点正在处理海量的并行计算任务以支撑大规模的信息检索、数据分析或科学计算等应用。在这样一个大规模的计算架构下，有效且健壮的任务处理框架是对使用者非常关键的。这样的框架应提供一种可行的方式方便使用者组织和使用底层巨大的计算资源池。具体来说，它应该能够促进应用开发和部署过程并提供QoS(Quality of Service)保证。它向用户提供一系列简单易用可控的编程接口，同时负责调度程序在众多服务器节点上高效运行。

在本章中，我们聚焦于执行SPMD(Single Program Multiple Data)类任务的分布式处理框架。用户提交作业给处理系统，系统将作业分割为大量任务分发到众多计算节点上执行，当所有节点完成分发的任务时作业也就完成了。各种作业任务根据运行特点大体可分为两类：数据密集型任务和计算密集型任务。数据密集型任务在执行过程中会产生大量的数据I/O，而计算密集型任务则在执行过程中只有少量数据I/O操作但需要更多的CPU开销。

我们观察到大多数计算框架针对数据密集型任务作出了优化而很少考虑计算密集型任务。其背后的主要原因涉及计算框架的任务调度组件。许多前人的研究\cite{Zaharia:2008:IMP:1855741.1855744, Ananthanarayanan:2010:ROM:1924943.1924962}已经证实异常节点(Outliers)是海量任务处理中最严重的性能杀手。异常节点的执行进度远远落后于相应的正常节点因而极大地拖延了整个作业的完成时间。在云计算平台中导致节点异常的原因有很多，通常不可预期的因素包括：硬件软件错误，网络拥塞等。为了解决这一问题，许多计算框架都依靠任务调度器识别异常节点并通过投机执行策略在正常空闲节点执行任务副本

近年来已经涌现了许多大规模分布式计算框架，最成功且有代表性的当属MapReduce。但它们缺少预测计算密集型任务进度的机制，也因此无法解决此类任务的异常节点问题。例如，Hadoop－－一个开源的MapReduce实现划分任务时以数据块为单位并以读入的数据量或比例作为任务进度的标志。这个方法蕴含的假设是任务执行进度和数据I/O是近似线性关系。许多主流的MapReduce调度优化工作都依赖于这一假设。然而，这对于计算密集型任务并不成立。当运行这类任务时，数据I/O通常只占用一小部分时间且I/O量是不均匀的。因此传统的任务进度预测和异常节点检测机制如果应用于计算密集型任务将变得不再有效。

考虑到计算密集型任务的重要性和普遍性（如：大数据分析和科学计算），我们提出了$NO^2$，一个设计用来处理海量计算密集型并行任务的计算框架调度器。该计算框架基于ProActive，一个面向异构网格和云的高性能工作流和应用的并行套件。$NO^2$基于程序插桩技术，通过采样动态选择插桩点减少运行时开销

将该方法应用于生产环境面临着如下挑战：1）程序插桩将带来不可接受的性能开销，例如：对于结构合理的程序，可以通过插桩函数入口以跟踪任务执行的位置。如果恰好选择了一个频繁被调用的函数，运行时开销将无法接受。为解决这个问题，$NO^2$引入了采样阶段以实现低开销、自动化地插桩点选择。2）即使准确地选择了插桩点进行程序插桩，仍然无法保证程序运行进度和插桩点被触发的累积数量呈线性关系。在任务执行过程中，一些插桩点可能更密集地被触发而另外一些插桩点被触发次数可能较少。这里，$NO^2$采用了\emph{k-means}聚类分析技术从插桩获得的任务进度跟踪数据中找出潜在的异常节点。

总体来说，$NO^2$的贡献主要在于：

设计实现了一个易于使用、高效且健壮的海量计算密集型任务处理框架

提出了基于程序插桩的计算密集型任务进度预测方法。该方法通过采样分析、收集程序特点以选择合适的插桩点保证运行时低开销

在运行时，采用了基于聚类分析的异常节点检测方法以进行任务调度。该方法对于不均匀的插桩点选择和不同类型的数据集赏表现稳定

\section{系统概览}
\label{sec:gemini_overview}
